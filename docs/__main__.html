<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1, minimum-scale=1" />
<meta name="generator" content="pdoc 0.10.0" />
<title>freshlinks.__main__ API documentation</title>
<meta name="description" content="Check to make sure your links are still fresh …" />
<link rel="preload stylesheet" as="style" href="https://cdnjs.cloudflare.com/ajax/libs/10up-sanitize.css/11.0.1/sanitize.min.css" integrity="sha256-PK9q560IAAa6WVRRh76LtCaI8pjTJ2z11v0miyNNjrs=" crossorigin>
<link rel="preload stylesheet" as="style" href="https://cdnjs.cloudflare.com/ajax/libs/10up-sanitize.css/11.0.1/typography.min.css" integrity="sha256-7l/o7C8jubJiy74VsKTidCy1yBkRtiUGbVkYBylBqUg=" crossorigin>
<link rel="stylesheet preload" as="style" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/10.1.1/styles/github.min.css" crossorigin>
<style>:root{--highlight-color:#fe9}.flex{display:flex !important}body{line-height:1.5em}#content{padding:20px}#sidebar{padding:30px;overflow:hidden}#sidebar > *:last-child{margin-bottom:2cm}.http-server-breadcrumbs{font-size:130%;margin:0 0 15px 0}#footer{font-size:.75em;padding:5px 30px;border-top:1px solid #ddd;text-align:right}#footer p{margin:0 0 0 1em;display:inline-block}#footer p:last-child{margin-right:30px}h1,h2,h3,h4,h5{font-weight:300}h1{font-size:2.5em;line-height:1.1em}h2{font-size:1.75em;margin:1em 0 .50em 0}h3{font-size:1.4em;margin:25px 0 10px 0}h4{margin:0;font-size:105%}h1:target,h2:target,h3:target,h4:target,h5:target,h6:target{background:var(--highlight-color);padding:.2em 0}a{color:#058;text-decoration:none;transition:color .3s ease-in-out}a:hover{color:#e82}.title code{font-weight:bold}h2[id^="header-"]{margin-top:2em}.ident{color:#900}pre code{background:#f8f8f8;font-size:.8em;line-height:1.4em}code{background:#f2f2f1;padding:1px 4px;overflow-wrap:break-word}h1 code{background:transparent}pre{background:#f8f8f8;border:0;border-top:1px solid #ccc;border-bottom:1px solid #ccc;margin:1em 0;padding:1ex}#http-server-module-list{display:flex;flex-flow:column}#http-server-module-list div{display:flex}#http-server-module-list dt{min-width:10%}#http-server-module-list p{margin-top:0}.toc ul,#index{list-style-type:none;margin:0;padding:0}#index code{background:transparent}#index h3{border-bottom:1px solid #ddd}#index ul{padding:0}#index h4{margin-top:.6em;font-weight:bold}@media (min-width:200ex){#index .two-column{column-count:2}}@media (min-width:300ex){#index .two-column{column-count:3}}dl{margin-bottom:2em}dl dl:last-child{margin-bottom:4em}dd{margin:0 0 1em 3em}#header-classes + dl > dd{margin-bottom:3em}dd dd{margin-left:2em}dd p{margin:10px 0}.name{background:#eee;font-weight:bold;font-size:.85em;padding:5px 10px;display:inline-block;min-width:40%}.name:hover{background:#e0e0e0}dt:target .name{background:var(--highlight-color)}.name > span:first-child{white-space:nowrap}.name.class > span:nth-child(2){margin-left:.4em}.inherited{color:#999;border-left:5px solid #eee;padding-left:1em}.inheritance em{font-style:normal;font-weight:bold}.desc h2{font-weight:400;font-size:1.25em}.desc h3{font-size:1em}.desc dt code{background:inherit}.source summary,.git-link-div{color:#666;text-align:right;font-weight:400;font-size:.8em;text-transform:uppercase}.source summary > *{white-space:nowrap;cursor:pointer}.git-link{color:inherit;margin-left:1em}.source pre{max-height:500px;overflow:auto;margin:0}.source pre code{font-size:12px;overflow:visible}.hlist{list-style:none}.hlist li{display:inline}.hlist li:after{content:',\2002'}.hlist li:last-child:after{content:none}.hlist .hlist{display:inline;padding-left:1em}img{max-width:100%}td{padding:0 .5em}.admonition{padding:.1em .5em;margin-bottom:1em}.admonition-title{font-weight:bold}.admonition.note,.admonition.info,.admonition.important{background:#aef}.admonition.todo,.admonition.versionadded,.admonition.tip,.admonition.hint{background:#dfd}.admonition.warning,.admonition.versionchanged,.admonition.deprecated{background:#fd4}.admonition.error,.admonition.danger,.admonition.caution{background:lightpink}</style>
<style media="screen and (min-width: 700px)">@media screen and (min-width:700px){#sidebar{width:30%;height:100vh;overflow:auto;position:sticky;top:0}#content{width:70%;max-width:100ch;padding:3em 4em;border-left:1px solid #ddd}pre code{font-size:1em}.item .name{font-size:1em}main{display:flex;flex-direction:row-reverse;justify-content:flex-end}.toc ul ul,#index ul{padding-left:1.5em}.toc > ul > li{margin-top:.5em}}</style>
<style media="print">@media print{#sidebar h1{page-break-before:always}.source{display:none}}@media print{*{background:transparent !important;color:#000 !important;box-shadow:none !important;text-shadow:none !important}a[href]:after{content:" (" attr(href) ")";font-size:90%}a[href][title]:after{content:none}abbr[title]:after{content:" (" attr(title) ")"}.ir a:after,a[href^="javascript:"]:after,a[href^="#"]:after{content:""}pre,blockquote{border:1px solid #999;page-break-inside:avoid}thead{display:table-header-group}tr,img{page-break-inside:avoid}img{max-width:100% !important}@page{margin:0.5cm}p,h2,h3{orphans:3;widows:3}h1,h2,h3,h4,h5,h6{page-break-after:avoid}}</style>
<script defer src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/10.1.1/highlight.min.js" integrity="sha256-Uv3H6lx7dJmRfRvH8TH6kJD1TSK1aFcwgx+mdg3epi8=" crossorigin></script>
<script>window.addEventListener('DOMContentLoaded', () => hljs.initHighlighting())</script>
</head>
<body>
<main>
<article id="content">
<header>
<h1 class="title">Module <code>freshlinks.__main__</code></h1>
</header>
<section id="section-intro">
<p>Check to make sure your links are still fresh.</p>
<pre><code class="language-text">Usage: freshlinks
    [--help | --version] [--debug]
    [--config PATH]
    [--cache DIR] [--cache-age AGE] [--cache-ignore DOMAIN...] [--cache-retry]
    [&lt;url&gt;...] [--ignore URL...]
    [--domain DOMAIN...] [--depth NUM]
    [--show-ok] [--show-err]

Options:
  -h, --help                show this message and exit
  --version                 show version and exit
  --debug                   show debug messages

Config:
  -c PATH, --config PATH    path to configuration file

Cache:
  --cache DIR               directory to load and store cache files
                            [default: ~/.cache/freshlinks]

  --cache-age AGE           ignore cache data older than this age [default: 5d]
                            units: d=days; h=hours; m = minutes; s=sec

  --cache-ignore DOMAIN     ignore cache for these domains (always ping)
  --cache-retry             ignore cached result if it was an error

Check:
  &lt;url&gt;                     URL to check
  --ignore URL              URL to ignore

Scrape:
  --domain DOMAIN           domains to include in link checking
  --depth NUM               maximum recursion depth for checking links [default: 10]

Output:
  --show-ok                 show URLs that were successfully reached
  --show-err                show error messages

Examples:
$ python -m freshlinks http://example.com
</code></pre>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">#!/usr/bin/env python
&#34;&#34;&#34;Check to make sure your links are still fresh.

```text
Usage: freshlinks
    [--help | --version] [--debug]
    [--config PATH]
    [--cache DIR] [--cache-age AGE] [--cache-ignore DOMAIN...] [--cache-retry]
    [&lt;url&gt;...] [--ignore URL...]
    [--domain DOMAIN...] [--depth NUM]
    [--show-ok] [--show-err]

Options:
  -h, --help                show this message and exit
  --version                 show version and exit
  --debug                   show debug messages

Config:
  -c PATH, --config PATH    path to configuration file

Cache:
  --cache DIR               directory to load and store cache files
                            [default: ~/.cache/freshlinks]

  --cache-age AGE           ignore cache data older than this age [default: 5d]
                            units: d=days; h=hours; m = minutes; s=sec

  --cache-ignore DOMAIN     ignore cache for these domains (always ping)
  --cache-retry             ignore cached result if it was an error

Check:
  &lt;url&gt;                     URL to check
  --ignore URL              URL to ignore

Scrape:
  --domain DOMAIN           domains to include in link checking
  --depth NUM               maximum recursion depth for checking links [default: 10]

Output:
  --show-ok                 show URLs that were successfully reached
  --show-err                show error messages

Examples:
$ python -m freshlinks http://example.com
```
&#34;&#34;&#34;

# std
from __future__ import annotations
from dataclasses import dataclass
from dataclasses import field
from pathlib import Path
from random import uniform
from time import sleep
from time import time
from typing import Dict
from typing import List
from typing import Literal
from typing import Optional
from typing import Set
from typing import Tuple

# lib
from attrbox import AttrDict
from attrbox import load_config
from attrbox import parse_docopt
from multiprocess import Manager  # type: ignore
from url_normalize.tools import deconstruct_url  # type: ignore
import ezq

# pkg
from .cache import age_time
from .cache import LinkCache
from .cache import LinkEntry
from .canonicalize import canonical_url
from .scraper import ping_url
from .scraper import scrape_links
from . import __version__


@dataclass
class Args:
    help: bool = False
    version: bool = False
    debug: bool = False
    config: Optional[Path] = None
    cache: Optional[Path] = None
    cache_age: str = &#34;5d&#34;
    cache_ignore: Set[str] = field(default_factory=set)
    cache_retry: bool = False
    url: List[str] = field(default_factory=list)
    ignore: List[str] = field(default_factory=list)
    domain: Set[str] = field(default_factory=set)
    depth: int = 10
    show_ok: bool = False
    show_err: bool = False

    @staticmethod
    def load() -&gt; Args:
        &#34;&#34;&#34;Load CLI arguments and any configuration files.&#34;&#34;&#34;
        args = parse_docopt(__doc__, version=__version__, read_config=False)
        config = AttrDict(load_config(Path(args.config))) if args.config else AttrDict()

        # NOTE: args overwrite configs
        for arg, val in args.items():
            if arg not in config:  # config doesn&#39;t have this arg
                config[arg] = val
            elif isinstance(val, list):  # merge lists
                config[arg] = list(config[arg] or []) + val
            elif isinstance(val, bool):  # merge bools
                config[arg] = config[arg] or val
            else:  # by default, arg wins
                config[arg] = val

        config.config = Path(config.config) if config.config else None
        config.cache = Path(config.cache) if config.cache else None
        config.cache_ignore = set(config.cache_ignore or [])
        config.url = [canonical_url(url) for url in config.url] if config.url else []
        config.depth = int(config.depth) if config.depth is not None else 10
        config.domain = set(
            config.domain or {deconstruct_url(url).host for url in (config.url or [])}
        )

        return Args(**config)


def inc_keys(stat: Dict[str, int], *keys: str) -&gt; None:
    &#34;&#34;&#34;Increment the string keys of a dict by 1.&#34;&#34;&#34;
    for key in keys:
        stat[key] = stat.get(key, 0) + 1


def print_stats(stat: Dict[str, int]) -&gt; None:
    &#34;&#34;&#34;Print right-aligned sorted keys with values.&#34;&#34;&#34;
    print(&#34;&#34;)
    n = max(len(k) for k in stat.keys())
    for k, v in sorted(stat.items()):
        print(f&#34;{k: &gt;{n}}:&#34;, v)


def print_entry(args: Args, entry: LinkEntry) -&gt; None:
    &#34;&#34;&#34;Print the result of a ping.&#34;&#34;&#34;
    if entry.ok and not args.show_ok:
        return

    print(
        f&#34;{&#39;ERR&#39; if entry.code == -1 else entry.code} &#34;
        f&#34;{&#39;(cache) &#39; if entry.is_cached else &#39;&#39;}&#34;
        f&#34;{entry.url}&#34;
    )
    if args.show_err:
        print(f&#34; ==&gt; {entry.err}&#34;)


def process_link(
    url: str,
    depth: int,
    args: Args,
    todo: List[Tuple[str, int]],
    done: Dict[str, Optional[LinkEntry]],
    stat: Dict[str, int],
    cache: LinkCache,
) -&gt; None:
    domain = deconstruct_url(url).host
    do_scrape = domain in args.domain and depth &lt;= args.depth

    entry = None
    if depth &gt; 0 and domain not in args.cache_ignore and cache and url in cache:
        entry = cache[url]
        if entry:
            inc_keys(stat, &#34;cache&#34;)

    if not entry or (args.cache_retry and not entry.ok):
        method: Literal[&#34;get&#34;, &#34;head&#34;] = &#34;get&#34; if do_scrape else &#34;head&#34;
        req, entry = ping_url(url, method)
        inc_keys(stat, f&#34;ping:{method}&#34;)

        if do_scrape and req:
            entry.links = list(scrape_links(req))
            inc_keys(stat, &#34;scrape&#34;)

        done[url] = entry
        if cache:
            cache[url] = entry

    inc_keys(stat, &#34;total&#34;, str(entry.code), &#34;ok&#34; if entry.ok else &#34;fail&#34;)
    print_entry(args, entry)

    if do_scrape and url not in args.ignore:
        for link in entry.links:
            if link not in done and link not in args.ignore:
                todo.append((link, depth + 1))


def worker_print(n: int, t: float, args: Args, msg: str) -&gt; None:
    &#34;&#34;&#34;Print a message from a worker.&#34;&#34;&#34;
    if not args.debug:
        return
    print(f&#34;{time() - t:07.1f} WORKER-{n}:&#34;, msg)


def worker_sleep(n: int, t: float, args: Args, todo: List[Tuple[str, int]]) -&gt; None:
    &#34;&#34;&#34;Sleep a worker, if needed.&#34;&#34;&#34;
    if not todo:
        worker_print(n, t, args, &#34;sleep&#34;)
        sleep(uniform(1, 4))  # wait for some more work
        worker_print(n, t, args, &#34;awake&#34;)


def worker(
    n: int,
    args: Args,
    todo: List[Tuple[str, int]],
    done: Dict[str, Optional[LinkEntry]],
    stat: Dict[str, int],
    cache: LinkCache,
) -&gt; None:
    &#34;&#34;&#34;Run a worker.&#34;&#34;&#34;
    t = time()
    worker_print(n, t, args, &#34;beg&#34;)
    worker_sleep(n, t, args, todo)  # don&#39;t start too early
    while todo:
        url, depth = None, 0
        try:
            url, depth = todo.pop()
        except IndexError:  # todo might actually be empty
            pass

        if url and url not in done:  # new link
            done[url] = None  # prevent other workers
            process_link(url, depth, args, todo, done, stat, cache)

        worker_sleep(n, t, args, todo)  # don&#39;t end too early
    worker_print(n, t, args, &#34;end&#34;)


def main() -&gt; None:
    &#34;&#34;&#34;Main entry point.&#34;&#34;&#34;
    t = time()
    args = Args.load()
    if args.debug:
        print(args)

    with Manager() as manager:
        todo = manager.list([(url, 0) for url in args.url])
        done = manager.dict()
        stat = manager.dict()
        cache = (
            LinkCache(
                manager.dict(),
                max_time=age_time(args.cache_age),
                path=args.cache,
            )
            if args.cache
            else None
        )

        _bundle = (args, todo, done, stat, cache)
        for w in [ezq.run(worker, n, *_bundle) for n in range(ezq.NUM_CPUS)]:
            w.join()

        stat[&#34;time&#34;] = f&#34;{time() - t:2.1f}s&#34;
        print_stats(stat)


if __name__ == &#34;__main__&#34;:
    main()</code></pre>
</details>
</section>
<section>
</section>
<section>
</section>
<section>
<h2 class="section-title" id="header-functions">Functions</h2>
<dl>
<dt id="freshlinks.__main__.inc_keys"><code class="name flex">
<span>def <span class="ident">inc_keys</span></span>(<span>stat: Dict[str, int], *keys: str) ‑> None</span>
</code></dt>
<dd>
<div class="desc"><p>Increment the string keys of a dict by 1.</p></div>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">def inc_keys(stat: Dict[str, int], *keys: str) -&gt; None:
    &#34;&#34;&#34;Increment the string keys of a dict by 1.&#34;&#34;&#34;
    for key in keys:
        stat[key] = stat.get(key, 0) + 1</code></pre>
</details>
</dd>
<dt id="freshlinks.__main__.print_stats"><code class="name flex">
<span>def <span class="ident">print_stats</span></span>(<span>stat: Dict[str, int]) ‑> None</span>
</code></dt>
<dd>
<div class="desc"><p>Print right-aligned sorted keys with values.</p></div>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">def print_stats(stat: Dict[str, int]) -&gt; None:
    &#34;&#34;&#34;Print right-aligned sorted keys with values.&#34;&#34;&#34;
    print(&#34;&#34;)
    n = max(len(k) for k in stat.keys())
    for k, v in sorted(stat.items()):
        print(f&#34;{k: &gt;{n}}:&#34;, v)</code></pre>
</details>
</dd>
<dt id="freshlinks.__main__.print_entry"><code class="name flex">
<span>def <span class="ident">print_entry</span></span>(<span>args: <a title="freshlinks.__main__.Args" href="#freshlinks.__main__.Args">Args</a>, entry: LinkEntry) ‑> None</span>
</code></dt>
<dd>
<div class="desc"><p>Print the result of a ping.</p></div>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">def print_entry(args: Args, entry: LinkEntry) -&gt; None:
    &#34;&#34;&#34;Print the result of a ping.&#34;&#34;&#34;
    if entry.ok and not args.show_ok:
        return

    print(
        f&#34;{&#39;ERR&#39; if entry.code == -1 else entry.code} &#34;
        f&#34;{&#39;(cache) &#39; if entry.is_cached else &#39;&#39;}&#34;
        f&#34;{entry.url}&#34;
    )
    if args.show_err:
        print(f&#34; ==&gt; {entry.err}&#34;)</code></pre>
</details>
</dd>
<dt id="freshlinks.__main__.process_link"><code class="name flex">
<span>def <span class="ident">process_link</span></span>(<span>url: str, depth: int, args: <a title="freshlinks.__main__.Args" href="#freshlinks.__main__.Args">Args</a>, todo: List[Tuple[str, int]], done: Dict[str, Optional[LinkEntry]], stat: Dict[str, int], cache: LinkCache) ‑> None</span>
</code></dt>
<dd>
<div class="desc"></div>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">def process_link(
    url: str,
    depth: int,
    args: Args,
    todo: List[Tuple[str, int]],
    done: Dict[str, Optional[LinkEntry]],
    stat: Dict[str, int],
    cache: LinkCache,
) -&gt; None:
    domain = deconstruct_url(url).host
    do_scrape = domain in args.domain and depth &lt;= args.depth

    entry = None
    if depth &gt; 0 and domain not in args.cache_ignore and cache and url in cache:
        entry = cache[url]
        if entry:
            inc_keys(stat, &#34;cache&#34;)

    if not entry or (args.cache_retry and not entry.ok):
        method: Literal[&#34;get&#34;, &#34;head&#34;] = &#34;get&#34; if do_scrape else &#34;head&#34;
        req, entry = ping_url(url, method)
        inc_keys(stat, f&#34;ping:{method}&#34;)

        if do_scrape and req:
            entry.links = list(scrape_links(req))
            inc_keys(stat, &#34;scrape&#34;)

        done[url] = entry
        if cache:
            cache[url] = entry

    inc_keys(stat, &#34;total&#34;, str(entry.code), &#34;ok&#34; if entry.ok else &#34;fail&#34;)
    print_entry(args, entry)

    if do_scrape and url not in args.ignore:
        for link in entry.links:
            if link not in done and link not in args.ignore:
                todo.append((link, depth + 1))</code></pre>
</details>
</dd>
<dt id="freshlinks.__main__.worker_print"><code class="name flex">
<span>def <span class="ident">worker_print</span></span>(<span>n: int, t: float, args: <a title="freshlinks.__main__.Args" href="#freshlinks.__main__.Args">Args</a>, msg: str) ‑> None</span>
</code></dt>
<dd>
<div class="desc"><p>Print a message from a worker.</p></div>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">def worker_print(n: int, t: float, args: Args, msg: str) -&gt; None:
    &#34;&#34;&#34;Print a message from a worker.&#34;&#34;&#34;
    if not args.debug:
        return
    print(f&#34;{time() - t:07.1f} WORKER-{n}:&#34;, msg)</code></pre>
</details>
</dd>
<dt id="freshlinks.__main__.worker_sleep"><code class="name flex">
<span>def <span class="ident">worker_sleep</span></span>(<span>n: int, t: float, args: <a title="freshlinks.__main__.Args" href="#freshlinks.__main__.Args">Args</a>, todo: List[Tuple[str, int]]) ‑> None</span>
</code></dt>
<dd>
<div class="desc"><p>Sleep a worker, if needed.</p></div>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">def worker_sleep(n: int, t: float, args: Args, todo: List[Tuple[str, int]]) -&gt; None:
    &#34;&#34;&#34;Sleep a worker, if needed.&#34;&#34;&#34;
    if not todo:
        worker_print(n, t, args, &#34;sleep&#34;)
        sleep(uniform(1, 4))  # wait for some more work
        worker_print(n, t, args, &#34;awake&#34;)</code></pre>
</details>
</dd>
<dt id="freshlinks.__main__.worker"><code class="name flex">
<span>def <span class="ident">worker</span></span>(<span>n: int, args: <a title="freshlinks.__main__.Args" href="#freshlinks.__main__.Args">Args</a>, todo: List[Tuple[str, int]], done: Dict[str, Optional[LinkEntry]], stat: Dict[str, int], cache: LinkCache) ‑> None</span>
</code></dt>
<dd>
<div class="desc"><p>Run a worker.</p></div>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">def worker(
    n: int,
    args: Args,
    todo: List[Tuple[str, int]],
    done: Dict[str, Optional[LinkEntry]],
    stat: Dict[str, int],
    cache: LinkCache,
) -&gt; None:
    &#34;&#34;&#34;Run a worker.&#34;&#34;&#34;
    t = time()
    worker_print(n, t, args, &#34;beg&#34;)
    worker_sleep(n, t, args, todo)  # don&#39;t start too early
    while todo:
        url, depth = None, 0
        try:
            url, depth = todo.pop()
        except IndexError:  # todo might actually be empty
            pass

        if url and url not in done:  # new link
            done[url] = None  # prevent other workers
            process_link(url, depth, args, todo, done, stat, cache)

        worker_sleep(n, t, args, todo)  # don&#39;t end too early
    worker_print(n, t, args, &#34;end&#34;)</code></pre>
</details>
</dd>
<dt id="freshlinks.__main__.main"><code class="name flex">
<span>def <span class="ident">main</span></span>(<span>) ‑> None</span>
</code></dt>
<dd>
<div class="desc"><p>Main entry point.</p></div>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">def main() -&gt; None:
    &#34;&#34;&#34;Main entry point.&#34;&#34;&#34;
    t = time()
    args = Args.load()
    if args.debug:
        print(args)

    with Manager() as manager:
        todo = manager.list([(url, 0) for url in args.url])
        done = manager.dict()
        stat = manager.dict()
        cache = (
            LinkCache(
                manager.dict(),
                max_time=age_time(args.cache_age),
                path=args.cache,
            )
            if args.cache
            else None
        )

        _bundle = (args, todo, done, stat, cache)
        for w in [ezq.run(worker, n, *_bundle) for n in range(ezq.NUM_CPUS)]:
            w.join()

        stat[&#34;time&#34;] = f&#34;{time() - t:2.1f}s&#34;
        print_stats(stat)</code></pre>
</details>
</dd>
</dl>
</section>
<section>
<h2 class="section-title" id="header-classes">Classes</h2>
<dl>
<dt id="freshlinks.__main__.Args"><code class="flex name class">
<span>class <span class="ident">Args</span></span>
<span>(</span><span>help: bool = False, version: bool = False, debug: bool = False, config: Optional[Path] = None, cache: Optional[Path] = None, cache_age: str = '5d', cache_ignore: Set[str] = &lt;factory&gt;, cache_retry: bool = False, url: List[str] = &lt;factory&gt;, ignore: List[str] = &lt;factory&gt;, domain: Set[str] = &lt;factory&gt;, depth: int = 10, show_ok: bool = False, show_err: bool = False)</span>
</code></dt>
<dd>
<div class="desc"><p>Args(help: 'bool' = False, version: 'bool' = False, debug: 'bool' = False, config: 'Optional[Path]' = None, cache: 'Optional[Path]' = None, cache_age: 'str' = '5d', cache_ignore: 'Set[str]' = <factory>, cache_retry: 'bool' = False, url: 'List[str]' = <factory>, ignore: 'List[str]' = <factory>, domain: 'Set[str]' = <factory>, depth: 'int' = 10, show_ok: 'bool' = False, show_err: 'bool' = False)</p></div>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">class Args:
    help: bool = False
    version: bool = False
    debug: bool = False
    config: Optional[Path] = None
    cache: Optional[Path] = None
    cache_age: str = &#34;5d&#34;
    cache_ignore: Set[str] = field(default_factory=set)
    cache_retry: bool = False
    url: List[str] = field(default_factory=list)
    ignore: List[str] = field(default_factory=list)
    domain: Set[str] = field(default_factory=set)
    depth: int = 10
    show_ok: bool = False
    show_err: bool = False

    @staticmethod
    def load() -&gt; Args:
        &#34;&#34;&#34;Load CLI arguments and any configuration files.&#34;&#34;&#34;
        args = parse_docopt(__doc__, version=__version__, read_config=False)
        config = AttrDict(load_config(Path(args.config))) if args.config else AttrDict()

        # NOTE: args overwrite configs
        for arg, val in args.items():
            if arg not in config:  # config doesn&#39;t have this arg
                config[arg] = val
            elif isinstance(val, list):  # merge lists
                config[arg] = list(config[arg] or []) + val
            elif isinstance(val, bool):  # merge bools
                config[arg] = config[arg] or val
            else:  # by default, arg wins
                config[arg] = val

        config.config = Path(config.config) if config.config else None
        config.cache = Path(config.cache) if config.cache else None
        config.cache_ignore = set(config.cache_ignore or [])
        config.url = [canonical_url(url) for url in config.url] if config.url else []
        config.depth = int(config.depth) if config.depth is not None else 10
        config.domain = set(
            config.domain or {deconstruct_url(url).host for url in (config.url or [])}
        )

        return Args(**config)</code></pre>
</details>
<h3>Class variables</h3>
<dl>
<dt id="freshlinks.__main__.Args.cache_ignore"><code class="name">var <span class="ident">cache_ignore</span> : Set[str]</code></dt>
<dd>
<div class="desc"></div>
</dd>
<dt id="freshlinks.__main__.Args.url"><code class="name">var <span class="ident">url</span> : List[str]</code></dt>
<dd>
<div class="desc"></div>
</dd>
<dt id="freshlinks.__main__.Args.ignore"><code class="name">var <span class="ident">ignore</span> : List[str]</code></dt>
<dd>
<div class="desc"></div>
</dd>
<dt id="freshlinks.__main__.Args.domain"><code class="name">var <span class="ident">domain</span> : Set[str]</code></dt>
<dd>
<div class="desc"></div>
</dd>
<dt id="freshlinks.__main__.Args.help"><code class="name">var <span class="ident">help</span> : bool</code></dt>
<dd>
<div class="desc"></div>
</dd>
<dt id="freshlinks.__main__.Args.version"><code class="name">var <span class="ident">version</span> : bool</code></dt>
<dd>
<div class="desc"></div>
</dd>
<dt id="freshlinks.__main__.Args.debug"><code class="name">var <span class="ident">debug</span> : bool</code></dt>
<dd>
<div class="desc"></div>
</dd>
<dt id="freshlinks.__main__.Args.config"><code class="name">var <span class="ident">config</span> : Optional[pathlib.Path]</code></dt>
<dd>
<div class="desc"></div>
</dd>
<dt id="freshlinks.__main__.Args.cache"><code class="name">var <span class="ident">cache</span> : Optional[pathlib.Path]</code></dt>
<dd>
<div class="desc"></div>
</dd>
<dt id="freshlinks.__main__.Args.cache_age"><code class="name">var <span class="ident">cache_age</span> : str</code></dt>
<dd>
<div class="desc"></div>
</dd>
<dt id="freshlinks.__main__.Args.cache_retry"><code class="name">var <span class="ident">cache_retry</span> : bool</code></dt>
<dd>
<div class="desc"></div>
</dd>
<dt id="freshlinks.__main__.Args.depth"><code class="name">var <span class="ident">depth</span> : int</code></dt>
<dd>
<div class="desc"></div>
</dd>
<dt id="freshlinks.__main__.Args.show_ok"><code class="name">var <span class="ident">show_ok</span> : bool</code></dt>
<dd>
<div class="desc"></div>
</dd>
<dt id="freshlinks.__main__.Args.show_err"><code class="name">var <span class="ident">show_err</span> : bool</code></dt>
<dd>
<div class="desc"></div>
</dd>
</dl>
<h3>Static methods</h3>
<dl>
<dt id="freshlinks.__main__.Args.load"><code class="name flex">
<span>def <span class="ident">load</span></span>(<span>) ‑> <a title="freshlinks.__main__.Args" href="#freshlinks.__main__.Args">Args</a></span>
</code></dt>
<dd>
<div class="desc"><p>Load CLI arguments and any configuration files.</p></div>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">@staticmethod
def load() -&gt; Args:
    &#34;&#34;&#34;Load CLI arguments and any configuration files.&#34;&#34;&#34;
    args = parse_docopt(__doc__, version=__version__, read_config=False)
    config = AttrDict(load_config(Path(args.config))) if args.config else AttrDict()

    # NOTE: args overwrite configs
    for arg, val in args.items():
        if arg not in config:  # config doesn&#39;t have this arg
            config[arg] = val
        elif isinstance(val, list):  # merge lists
            config[arg] = list(config[arg] or []) + val
        elif isinstance(val, bool):  # merge bools
            config[arg] = config[arg] or val
        else:  # by default, arg wins
            config[arg] = val

    config.config = Path(config.config) if config.config else None
    config.cache = Path(config.cache) if config.cache else None
    config.cache_ignore = set(config.cache_ignore or [])
    config.url = [canonical_url(url) for url in config.url] if config.url else []
    config.depth = int(config.depth) if config.depth is not None else 10
    config.domain = set(
        config.domain or {deconstruct_url(url).host for url in (config.url or [])}
    )

    return Args(**config)</code></pre>
</details>
</dd>
</dl>
</dd>
</dl>
</section>
</article>
<nav id="sidebar">
<h1>Index</h1>
<div class="toc">
<ul></ul>
</div>
<ul id="index">
<li><h3>Super-module</h3>
<ul>
<li><code><a title="freshlinks" href="index.html">freshlinks</a></code></li>
</ul>
</li>
<li><h3><a href="#header-functions">Functions</a></h3>
<ul class="two-column">
<li><code><a title="freshlinks.__main__.inc_keys" href="#freshlinks.__main__.inc_keys">inc_keys</a></code></li>
<li><code><a title="freshlinks.__main__.print_stats" href="#freshlinks.__main__.print_stats">print_stats</a></code></li>
<li><code><a title="freshlinks.__main__.print_entry" href="#freshlinks.__main__.print_entry">print_entry</a></code></li>
<li><code><a title="freshlinks.__main__.process_link" href="#freshlinks.__main__.process_link">process_link</a></code></li>
<li><code><a title="freshlinks.__main__.worker_print" href="#freshlinks.__main__.worker_print">worker_print</a></code></li>
<li><code><a title="freshlinks.__main__.worker_sleep" href="#freshlinks.__main__.worker_sleep">worker_sleep</a></code></li>
<li><code><a title="freshlinks.__main__.worker" href="#freshlinks.__main__.worker">worker</a></code></li>
<li><code><a title="freshlinks.__main__.main" href="#freshlinks.__main__.main">main</a></code></li>
</ul>
</li>
<li><h3><a href="#header-classes">Classes</a></h3>
<ul>
<li>
<h4><code><a title="freshlinks.__main__.Args" href="#freshlinks.__main__.Args">Args</a></code></h4>
<ul class="two-column">
<li><code><a title="freshlinks.__main__.Args.load" href="#freshlinks.__main__.Args.load">load</a></code></li>
<li><code><a title="freshlinks.__main__.Args.cache_ignore" href="#freshlinks.__main__.Args.cache_ignore">cache_ignore</a></code></li>
<li><code><a title="freshlinks.__main__.Args.url" href="#freshlinks.__main__.Args.url">url</a></code></li>
<li><code><a title="freshlinks.__main__.Args.ignore" href="#freshlinks.__main__.Args.ignore">ignore</a></code></li>
<li><code><a title="freshlinks.__main__.Args.domain" href="#freshlinks.__main__.Args.domain">domain</a></code></li>
<li><code><a title="freshlinks.__main__.Args.help" href="#freshlinks.__main__.Args.help">help</a></code></li>
<li><code><a title="freshlinks.__main__.Args.version" href="#freshlinks.__main__.Args.version">version</a></code></li>
<li><code><a title="freshlinks.__main__.Args.debug" href="#freshlinks.__main__.Args.debug">debug</a></code></li>
<li><code><a title="freshlinks.__main__.Args.config" href="#freshlinks.__main__.Args.config">config</a></code></li>
<li><code><a title="freshlinks.__main__.Args.cache" href="#freshlinks.__main__.Args.cache">cache</a></code></li>
<li><code><a title="freshlinks.__main__.Args.cache_age" href="#freshlinks.__main__.Args.cache_age">cache_age</a></code></li>
<li><code><a title="freshlinks.__main__.Args.cache_retry" href="#freshlinks.__main__.Args.cache_retry">cache_retry</a></code></li>
<li><code><a title="freshlinks.__main__.Args.depth" href="#freshlinks.__main__.Args.depth">depth</a></code></li>
<li><code><a title="freshlinks.__main__.Args.show_ok" href="#freshlinks.__main__.Args.show_ok">show_ok</a></code></li>
<li><code><a title="freshlinks.__main__.Args.show_err" href="#freshlinks.__main__.Args.show_err">show_err</a></code></li>
</ul>
</li>
</ul>
</li>
</ul>
</nav>
</main>
<footer id="footer">
<p>Generated by <a href="https://pdoc3.github.io/pdoc" title="pdoc: Python API documentation generator"><cite>pdoc</cite> 0.10.0</a>.</p>
</footer>
</body>
</html>